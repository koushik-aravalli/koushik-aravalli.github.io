{"componentChunkName":"component---src-templates-blog-post-js","path":"/AzureDevOps-Agent-OAuth-CreateBranch/","result":{"data":{"site":{"siteMetadata":{"title":"Koushik's scribble"}},"markdownRemark":{"id":"b1b0e9b3-452a-53ab-a038-14fffca7483b","excerpt":"What is the reason behind Working more AzureDevOps, artifacts are generated during the build process and release follows based on the artifacts, basic CI/CD…","html":"<!-- Post Content -->\n<h2>What is the reason behind</h2>\n<p>Working more AzureDevOps, artifacts are generated during the build process and release follows based on the artifacts, basic CI/CD. </p>\n<p>At times, extensions require an OAuth to be enabled on the agent to perform actions within Azure DevOps e.g., creating or updating work items on a task board, creating a new repository or creating new branch, creating or completing a pull request. So two questions, under who’s context is this OAuth generated, and how to provide fine grained access to create branch and pr. </p>\n<p> <img src=\"../../assets2021-03-14-OAuth-token-security.jpg\"></p>\n<h3>To answer the first question, <em>under who’s context is this OAuth generated></em>:</h3>\n<p>First lets understand permissions within Azure DevOp. An Azure DevOps Organization has built-in default accounts and groups that are created and managed by AzureDevOps Service. These are at both Collection (Organization) level and Project level. <em>(Side note, Collection comes from the Team Foundation Service)</em></p>\n<p><em>For additional information <a href=\"https://docs.microsoft.com/en-us/azure/devops/organizations/security/permissions?view=azure-devops&#x26;tabs=preview-page#service-accounts\">Refer</a></em> to Azure DevOps documentation. </p>\n<p>The closest lead <code class=\"language-text\">Agent Pool Service</code> who belong to the collections <code class=\"language-text\">Security Service Group</code>.  Notice that within this security group there are Project level <code class=\"language-text\">&lt;projectname> Build Service</code> - one for each project and one <code class=\"language-text\">Project Collection Build Service (&lt;organizationname>)</code>. One of these two will be a used by the agents. Now that is only a partial answer because which service account is it Collection or Project? And next question is fine grained controls that AzureDevOps provides for each service account </p>\n<p> <img src=\"../../assets2021-03-14-agentpoolservice.jpg\"></p>\n<p>The default behavior is always from the Collection level, so the <code class=\"language-text\">Project Collection Build Service (&lt;organizationname>)</code> will be used by the Agent for OAuth generation. </p>\n<p>In some organizations, where a central IT team owns the Azure DevOps Organization and Projects are created per DevOps teams,  collection level access is restricted. It can be verified by checking out the Azure DevOps Organization Settings.</p>\n<p> <img src=\"../../assets2021-03-14-Organization-Settings.jpg\"></p>\n<p>This setting can also be managed from the Project level, if not set at Organization level. </p>\n<p> <img src=\"../../assets2021-03-14-Project-Settings.jpg\"></p>\n<p>By limiting the job authorization scope, all the pipelines within the Projects consider <code class=\"language-text\">&lt;projectname> Build Service</code> instead of Collection level Build Service.</p>\n<h3>To answer the second question, <em>how to provide fine grained access to create branch and pull request</em>:</h3>\n<p>Fine grained controls for the service account are set at Project level by selecting Project Settings → Repos → Repositories. Select <code class=\"language-text\">Security</code> on <code class=\"language-text\">All Repositories</code> or each repository.</p>\n<p> <img src=\"../../assets2021-03-14-Secuirty-BuildService-Allow.jpg\"></p>\n<p>That is it .. now create a script which can create a new branch and does a Pull Request. </p>","frontmatter":{"title":"Using AzureDevOps Agent's OAuth to create branch","date":"March 14, 2021","description":"","tags":["azure-devops"]}}},"pageContext":{"slug":"/AzureDevOps-Agent-OAuth-CreateBranch/","previous":{"fields":{"slug":"/AzureVnet-as-markdown/"},"frontmatter":{"title":"Azure Network Solution as a Markdown"}},"next":{"fields":{"slug":"/CKAD-preparation/"},"frontmatter":{"title":"CKAD Preparation - Development Environment"}}}},"staticQueryHashes":["2841359383"]}