{"componentChunkName":"component---src-templates-blog-post-js","path":"/k8s-dashboard-token/","result":{"data":{"site":{"siteMetadata":{"title":"Koushik's scribble"}},"markdownRemark":{"id":"840e7c71-1f4a-5f56-b95c-fc4d16e3540a","excerpt":"Local development of k8s using Docker Desktop is often what I do before deploying services on the Cloud platform. Last month, auto upgrade of the local versionâ€¦","html":"<!-- Post Content -->\n<p>Local development of k8s using Docker Desktop is often what I do before deploying services on the Cloud platform. Last month, auto upgrade of the local version to k8s caused unexpected behaviour of the service accounts. Bumping into <a href=\"https://github.com/kubernetes/kubernetes/issues/110113\">Github Ref</a> made it clear. </p>\n<p>Kubernetes dashboard is one of them which is accessed using SA token. Starting v1.24 version no tokens are provided on service account creation, which improves security of the access and restricting adhoc usage. </p>\n<p>So the basic steps to get the dashboard locally up and running:</p>\n<h3>Install Prerequisites</h3>\n<ul>\n<li>Install <a href=\"https://www.docker.com/products/docker-desktop/\">Docker Desktop</a> with Kubernetes - no additinal installation required for <a href=\"https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/\">kubectl</a></li>\n<li>Install <a href=\"https://docs.microsoft.com/en-us/windows/wsl/install\">Windows Subsystem for Linux (wsl)</a></li>\n<li>(optional) <a href=\"https://docs.microsoft.com/en-us/windows/terminal/install\">Windows Terminal</a></li>\n<li>(optional) <a href=\"https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-10#1-overview\">Ubuntu Terminal</a></li>\n</ul>\n<h3>Deploy Kubernetes Dashboard</h3>\n<p>k8s provide default dashboard to monitor the resources within the cluster, deployed using the <a href=\"https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.0/aio/deploy/recommended.yaml\">recommended manifest(s)</a></p>\n<p>Notice that all the objects are within the namespace <code class=\"language-text\">kubernetes-dashboard</code> unlike <code class=\"language-text\">kube-system</code>. Upon deploying the manifest on the cluster <code class=\"language-text\">kubectl apply &lt;manifest-url></code>, dashboard is almost ready for access. The dashboard is now exposed on port 443 within the cluster which needs to be mapped to localhost port. </p>\n<p>Using <code class=\"language-text\">kubectl proxy</code>, exposes the Cluster API server on port 8001. Try validating the version</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> curl http://localhost:8001/api\n\n{\n  \"kind\": \"APIVersions\",\n  \"versions\": [\n    \"v1\"\n  ],\n  \"serverAddressByClientCIDRs\": [\n    {\n      \"clientCIDR\": \"0.0.0.0/0\",\n      \"serverAddress\": \"192.168.65.4:6443\"\n    }\n  ]\n}</code></pre></div>\n<h3>Accessing the Dashboard</h3>\n<p>The dashboard can be accessed using the url </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/56d120b1be6bf13851db8be89fce6235/67471/2022-06-01-k8s-dashboard.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAewnfRA0Bf/EABkQAAIDAQAAAAAAAAAAAAAAAAADAhATIf/aAAgBAQABBQLKBksxWJ7Gv//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwGIiP/EABcRAAMBAAAAAAAAAAAAAAAAAAABERL/2gAIAQIBAT8BrNM//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEyEIH/2gAIAQEABj8ClEIhHd//xAAYEAEAAwEAAAAAAAAAAAAAAAABEBEhUf/aAAgBAQABPyHrNIpW29T/AP/aAAwDAQACAAMAAAAQUC//xAAXEQEBAQEAAAAAAAAAAAAAAAABADFh/9oACAEDAQE/EBDLhf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAEWH/2gAIAQIBAT8QTc1urf/EABsQAAICAwEAAAAAAAAAAAAAAAABEfEQIUGR/9oACAEBAAE/EFuXjKgoh5uaOW57n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2022 06 01 k8s dashboard\"\n        title=\"2022 06 01 k8s dashboard\"\n        src=\"/static/56d120b1be6bf13851db8be89fce6235/1c72d/2022-06-01-k8s-dashboard.jpg\"\n        srcset=\"/static/56d120b1be6bf13851db8be89fce6235/a80bd/2022-06-01-k8s-dashboard.jpg 148w,\n/static/56d120b1be6bf13851db8be89fce6235/1c91a/2022-06-01-k8s-dashboard.jpg 295w,\n/static/56d120b1be6bf13851db8be89fce6235/1c72d/2022-06-01-k8s-dashboard.jpg 590w,\n/static/56d120b1be6bf13851db8be89fce6235/a8a14/2022-06-01-k8s-dashboard.jpg 885w,\n/static/56d120b1be6bf13851db8be89fce6235/67471/2022-06-01-k8s-dashboard.jpg 1072w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>To securely accessf it, use the service account <code class=\"language-text\"></code> that is created during the dashboard deployment.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> kubectl get sa -n kubernetes-dashboard\nNAME                   SECRETS   AGE\ndefault                0         27h\nkubernetes-dashboard   0         27h</code></pre></div>\n<p>Before v1.24,, all service accounts were created with a token that is saved within the secrets. That way copying the token made it easier to login into the dashboard. But now there is no longer an auto-generated <strong>static</strong> token. </p>\n<p>Therefore, request a new token for the service account which is valid for 60 mins (default). </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl create token kubernetes-dashboard -n kubernetes-dashboard</code></pre></div>\n<p>In the portal, select option as <code class=\"language-text\">Token</code> and paste the token to login.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b65fa1415a1617f07192fe81d547cf39/5fbb4/2022-06-01-k8s-dashboard-loggedin.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdmFgH//xAAXEAEAAwAAAAAAAAAAAAAAAAABAAIS/9oACAEBAAEFAgAxWYrP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/Aauv/8QAFhAAAwAAAAAAAAAAAAAAAAAAABAx/9oACAEBAAY/AlD/xAAaEAEAAgMBAAAAAAAAAAAAAAABAGERIaHw/9oACAEBAAE/IXAZ3co6zwWf/9oADAMBAAIAAwAAABAED//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxCIiP/EABcRAQADAAAAAAAAAAAAAAAAAAARUWH/2gAIAQIBAT8QlbZ//8QAGhAAAQUBAAAAAAAAAAAAAAAAAQARUWHwIf/aAAgBAQABPxAIDOCHKAxqVY1a/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2022 06 01 k8s dashboard loggedin\"\n        title=\"2022 06 01 k8s dashboard loggedin\"\n        src=\"/static/b65fa1415a1617f07192fe81d547cf39/1c72d/2022-06-01-k8s-dashboard-loggedin.jpg\"\n        srcset=\"/static/b65fa1415a1617f07192fe81d547cf39/a80bd/2022-06-01-k8s-dashboard-loggedin.jpg 148w,\n/static/b65fa1415a1617f07192fe81d547cf39/1c91a/2022-06-01-k8s-dashboard-loggedin.jpg 295w,\n/static/b65fa1415a1617f07192fe81d547cf39/1c72d/2022-06-01-k8s-dashboard-loggedin.jpg 590w,\n/static/b65fa1415a1617f07192fe81d547cf39/a8a14/2022-06-01-k8s-dashboard-loggedin.jpg 885w,\n/static/b65fa1415a1617f07192fe81d547cf39/fbd2c/2022-06-01-k8s-dashboard-loggedin.jpg 1180w,\n/static/b65fa1415a1617f07192fe81d547cf39/5fbb4/2022-06-01-k8s-dashboard-loggedin.jpg 1887w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Thats should be it to access the portal. During the deployment of the Dashboard in the manifest the, the role binding for the <code class=\"language-text\">kubernetes-dashboard</code> are scoped within the namespace. This is the reason the notification errors pop out on accessing the default namespace objects. Good practice is to create a new service account with required scope access.</p>","frontmatter":{"title":"Access Kubernetes Dashboard with k8s v1.24","date":"June 01, 2022","description":"","tags":["kubernetes"]}}},"pageContext":{"slug":"/k8s-dashboard-token/","previous":{"fields":{"slug":"/Helm-Umbrella-chart-local-chart/"},"frontmatter":{"title":"Helm - Umbrella chart using local reference"}},"next":null}},"staticQueryHashes":["2841359383"]}